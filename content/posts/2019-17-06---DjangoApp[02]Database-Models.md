---
title: Django App[02] Database, Models
date: "2019-06-17T15:31:37.121Z"
template: "post"
draft: false
slug: "/posts/DjangoApp Database Models"
category: "Django"
tags:
  - "Python"
  - "Django"
description: "Following a Django tutorial on djangoproject.com to create a django app."
---

#1. Database setup
`mysite/settings.py`: a normal Python module with module-level variables representing Django settings.

`INSTALLED_APPS`: holds the name of all Django applications that are activated in this Django instance

`migrate`: looks at the `INSTALLED_APPS` setting and creates any necessary database tables according to the database settings in `mysite/settings.py` file and the database migrations shipped with the app.

#2. Creating models
models: database layout. contains the essential fields and behaviors of the data you're storing

- <b>Question</b> has a question and a publication date
- <b>Choice</b> has two fields: the text of the choice and a vote tally

```
## polls/models.py

from django.db import models

class Question(models.Model):
    question_text = models.CharField(max_length=200)
    pub_date = models.DateTimeField('date published')

class Choice(models.Model):
    question = models.ForeignKey(Question, on_delete=models.CASCADE)
    choice_text = models.CharField(max_length=200)
    votes = models.IntegerField(default=0)
```

Each model is represented by a class that subclasses `django.db.models.Model`<br>

- `Field` instance such as `question_text` is the field's name
- Some `Field` classes have required arguments like `max_length` for `CharField`
- `Fields` also have optional arguments like `default` for `IntegerField`
- a relationship is defined: `ForeignKey` tells that each `Choice` is related to a single `Question`
  - many-to-one, many-to-many, one-to-one

#3. Activating models
Gotta tell the project that an app is installed.

- add a reference to its configuration class in the `INSTALLED_APPS` setting.
- get the name of the class written in `polls/apps.py` file and add it to `INSTALLED_APPS`

```
python3 manage.py makemigrations polls
```

`makemigrations` command makes Django realize that some changes have been made to your models and stores the changes as a migration.
<b>Migrations</b>are how Django stores changes to models--they are just files on disk.
`sqlmigrate` command takes migration names and returns their SQL

- Table names are automatically generated by combining the name of the apps(<b>polls</b>) and the lowercase name of the model(<b>question</b> and <b>choice</b>)
- Primary keys are added automatically, which can be overridden.
- Django appends `_id` to the foreign key field name by convention, which could be overridden
- The foreign key relationship is made explicit by a `FOREIGN KEY` constraint

`makemigrations` command does not actually run the migration. `migrate` command needs to be used.

```
python3 manage.py migrate
```

`migrate` command

1. takes all the migrations that haven't been applied and runs them against the database.
2. allows you to change your models over time without the need to delete database/tables and to make new ones
3. upgrades database live without losing data

##Three steps guide to making model changes

1. change your models in `modles.py`
2. `python3 manage.py makemigrations` to create migrations for those changes (changes in models)
3. `python3 manage.py migrate` to apply those changes to the database
